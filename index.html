<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeniCopy Pro - Gestion Photocopie</title>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">
  
  <style>
    /* ==================== VARIABLES ==================== */
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --danger: #f72585;
      --warning: #f8961e;
      --info: #4895ef;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --white: #ffffff;
      --sidebar: #2b2d42;
      --sidebar-hover: #3a3d5d;
      --sidebar-text: #edf2f4;
    }

    /* ==================== GLOBAL STYLES ================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f7fa;
      color: var(--dark);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* ==================== LOGIN PAGE =================== */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 20px;
    }

    .login-card {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 450px;
      padding: 40px;
      animation: fadeInUp 0.6s ease-out;
      position: relative;
      overflow: hidden;
    }

    .login-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--success));
    }

    .login-logo {
      text-align: center;
      margin-bottom: 30px;
    }

    .login-logo img {
      height: 70px;
    }

    .login-title {
      text-align: center;
      margin-bottom: 25px;
      color: var(--dark);
      font-weight: 600;
      font-size: 1.8rem;
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s;
      background-color: var(--light);
    }

    .form-control:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      outline: none;
    }

    .password-toggle {
      position: absolute;
      right: 15px;
      top: 40px;
      cursor: pointer;
      color: var(--gray);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 20px;
      border-radius: 8px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 15px;
      gap: 8px;
    }

    .btn-block {
      width: 100%;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--white);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-secondary {
      background: var(--gray);
      color: var(--white);
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-success {
      background: var(--success);
      color: var(--white);
    }

    .btn-success:hover {
      background: #3bb4d9;
    }

    .btn-danger {
      background: var(--danger);
      color: var(--white);
    }

    .btn-danger:hover {
      background: #d91a6b;
    }

    .btn-sm {
      padding: 8px 12px;
      font-size: 14px;
    }

    .login-footer {
      text-align: center;
      margin-top: 25px;
      color: var(--gray);
      font-size: 14px;
    }

    /* ==================== APP LAYOUT =================== */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    .app-header {
      background: var(--white);
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
      padding: 0 25px;
      height: 70px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      width: 100%;
      z-index: 1000;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      height: 40px;
    }

    .brand-name {
      font-weight: 600;
      font-size: 1.2rem;
      color: var(--dark);
    }

    .current-time {
      font-weight: 500;
      color: var(--gray);
    }

    .user-menu {
      position: relative;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .user-name {
      font-weight: 500;
    }

    .user-role {
      font-size: 0.8rem;
      color: var(--gray);
    }

    .user-dropdown {
      position: absolute;
      top: 60px;
      right: 0;
      background: var(--white);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      width: 220px;
      overflow: hidden;
      display: none;
      z-index: 1001;
    }

    .user-dropdown.show {
      display: block;
    }

    .user-dropdown-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--dark);
      text-decoration: none;
      transition: all 0.3s;
    }

    .user-dropdown-item:hover {
      background: var(--light);
      color: var(--primary);
    }

    .sidebar {
      width: 260px;
      background: var(--sidebar);
      position: fixed;
      top: 70px;
      bottom: 0;
      left: 0;
      overflow-y: auto;
      z-index: 999;
      transition: all 0.3s;
      padding: 20px 0;
    }

    .nav {
      list-style: none;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: var(--sidebar-text);
      text-decoration: none;
      transition: all 0.3s;
      margin: 5px 10px;
      border-radius: 6px;
      gap: 12px;
    }

    .nav-item:hover {
      background: var(--sidebar-hover);
    }

    .nav-item.active {
      background: var(--primary);
      box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
    }

    .main-content {
      flex: 1;
      margin-left: 260px;
      margin-top: 70px;
      padding: 25px;
      transition: all 0.3s;
    }

    /* ==================== COMPONENTS =================== */
    .card {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 25px;
      overflow: hidden;
    }

    .card-header {
      padding: 18px 25px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .card-header h2 {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-body {
      padding: 25px;
    }

    .table-responsive {
      overflow-x: auto;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    .table th,
    .table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .table th {
      background-color: #f8f9fa;
      font-weight: 600;
      position: sticky;
      top: 0;
    }

    .badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-success {
      background-color: #e8f5e9;
      color: #2ecc71;
    }

    .badge-danger {
      background-color: #ffebee;
      color: #e74c3c;
    }

    .badge-warning {
      background-color: #fff3cd;
      color: #f39c12;
    }

    .badge-info {
      background-color: #d1ecf1;
      color: #17a2b8;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      backdrop-filter: blur(5px);
    }

    .modal.show {
      display: flex;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-content {
      background: var(--white);
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transform: translateY(-20px);
      transition: all 0.3s;
    }

    .modal.show .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      padding: 18px 25px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h4 {
      margin: 0;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .modal-body {
      padding: 25px;
    }

    .modal-footer {
      padding: 15px 25px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .close-modal {
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray);
      background: none;
      border: none;
    }

    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-left: 4px solid;
    }

    .alert-danger {
      background: #ffebee;
      color: #e74c3c;
      border-left-color: #e74c3c;
    }

    .alert-success {
      background: #e8f5e9;
      color: #2ecc71;
      border-left-color: #2ecc71;
    }

    /* ================= SPECIFIC PAGES ================== */
    /* Dashboard */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: var(--white);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      border-left: 4px solid var(--primary);
      transition: transform 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-card h3 {
      font-size: 0.9rem;
      color: var(--gray);
      margin-bottom: 10px;
      font-weight: 500;
    }

    .stat-card .value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
    }

    /* Reports */
    #daily-revenue-details {
      background: var(--light);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    #total-profit-display {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      padding: 15px;
      background: var(--light);
      border-radius: 8px;
      text-align: center;
    }

    .report-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    .report-table th, 
    .report-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .report-table th {
      background-color: #f1f3f5;
    }

    /* Sales Modal */
    .sale-item {
      display: grid;
      grid-template-columns: 3fr 1fr 1fr 1fr auto;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 6px;
    }

    .sale-summary {
      text-align: right;
      margin-top: 20px;
      font-size: 1.2rem;
      padding: 15px;
      background: var(--light);
      border-radius: 8px;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    /* ==================== ANIMATIONS =================== */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animated {
      animation-duration: 0.5s;
      animation-fill-mode: both;
    }

    .fade-in {
      animation-name: fadeIn;
    }

    /* =================== RESPONSIVE ==================== */
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
        z-index: 1001;
      }
      .sidebar.show {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
      }
    }

    @media (max-width: 768px) {
      .card-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .user-name,
      .user-role {
        display: none;
      }
      
      .sale-item {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
    }

    /* Print styles */
    @media print {
      .no-print {
        display: none !important;
      }
      
      .main-content {
        margin-left: 0;
        margin-top: 0;
        padding: 0;
      }
      
      .card {
        box-shadow: none;
        border: 1px solid #ddd;
      }
    }
  </style>
</head>
<body>

  <!-- ==================== LOGIN PAGE =================== -->
  <div id="login-page" class="login-container">
    <div class="login-card">
      <div class="login-logo">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSIjNDM2MWVlIiBkPSJNMjU2IDhDMTE5IDggOCAxMTkgOCAyNTZzMTExIDI0OCAyNDggMjQ4IDI0OC0xMTEgMjQ4LTI0OFMzOTMgOCAyNTYgOHptMCA0NDhjLTExMC41IDAtMjAwLTg5LjUtMjAwLTIwMFMxNDUuNSA1NiAyNTYgNTZzMjAwIDg5LjUgMjAwIDIwMC04OS41IDIwMC0yMDAgMjAwem05Ni4zLTMxMC4zTDMyNiAzOTQuN2MtNC43IDQuNy0xMi4zIDQuNy0xNyAwTDE1OS43IDI1NmwxNDkuMS0xNDkuN2M0LjctNC43IDEyLjMtNC43IDE3IDBsMzYuNyAzNi43YzQuNyA4LjcgNC43IDEyLjMgMCAxN3oiLz48L3N2Zz4=" alt="Logo">
      </div>
      <h2 class="login-title">Connexion à GeniCopy Pro</h2>
      
      <div id="login-alert" class="alert alert-danger" style="display: none;">
        <i class="fas fa-exclamation-circle"></i>
        <span id="alert-message">Identifiants incorrects</span>
      </div>
      
      <form id="login-form">
        <div class="form-group">
          <label class="form-label">Nom d'utilisateur</label>
          <input type="text" class="form-control" id="username" placeholder="Entrez votre nom d'utilisateur" required>
        </div>
        <div class="form-group">
          <label class="form-label">Mot de passe</label>
          <input type="password" class="form-control" id="password" placeholder="Entrez votre mot de passe" required>
          <i class="fas fa-eye password-toggle" id="toggle-password"></i>
        </div>
        <button type="submit" class="btn btn-primary btn-block">
          <i class="fas fa-sign-in-alt"></i> Se connecter
        </button>
      </form>
      
      <div class="login-footer">
        <p>GeniCopy Pro v2.1 &copy; 2025</p>
        <p class="signature">Conçu par Pernaude ADDA</p>
      </div>
    </div>
  </div>

  <!-- ================= APP CONTAINER =================== -->
  <div class="app-container" style="display: none;">
    
    <!-- App Header -->
    <header class="app-header">
      <div class="brand">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSIjNDM2MWVlIiBkPSJNMjU2IDhDMTE5IDggOCAxMTkgOCAyNTZzMTExIDI0OCAyNDggMj�4IDI0OC0xMTEgMjQ4LTI0OFMzOTMgOCAyNTYgOHptMCA0NDhjLTExMC41IDAtMjAwLTg5LjUtMjAwLTIwMFMxNDUuNSA1NiAyNTYgNTZzMjAwIDg5LjUgMjAwIDIwMC04OS41IDIwMC0yMDAgMjAwem05Ni4zLTMxMC4zTDMyNiAzOTQuN2MtNC43IDQuNy0xMi4zIDQuNy0xNyAwTDE1OS43IDI1NmwxNDkuMS0xNDkuN2M0LjctNC43IDEyLjMtNC43IDE3IDBsMzYuNyAzNi43YzQuNyA0LjcgNC43IDEyLjMgMCAxN3oiLz48L3N2Zz4=" alt="Logo" class="logo">
        <span class="brand-name">GeniCopy Pro</span>
      </div>
      <div class="current-time">
        <span id="current-date-time"></span>
      </div>
      <div class="user-menu">
        <div class="user-info">
          <div class="user-avatar">A</div>
          <div>
            <div class="user-name">Admin</div>
            <div class="user-role">Administrateur</div>
          </div>
        </div>
        <div class="user-dropdown">
          <a href="#" class="user-dropdown-item" id="logout-btn">
            <i class="fas fa-sign-out-alt"></i> Déconnexion
          </a>
        </div>
      </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar no-print">
      <nav class="nav" id="main-nav">
        <!-- Navigation items will be injected by JS based on user role -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      
      <!-- ==================== DASHBOARD PAGE ==================== -->
      <div class="page" id="dashboard-page">
        <div class="card animated fade-in">
          <div class="card-header">
            <h2><i class="fas fa-tachometer-alt"></i> Tableau de bord</h2>
          </div>
          <div class="card-body">
            <div class="stats-container">
              <!-- Stats cards will be here -->
            </div>
            <div class="chart-container">
              <canvas id="revenue-chart" height="100"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== PHOTOCOPY PAGE ==================== -->
      <div class="page" id="photocopy-page" style="display: none;">
        <div class="card animated fade-in">
          <div class="card-header">
            <h2><i class="fas fa-copy"></i> Services de Photocopie</h2>
            <button class="btn btn-primary" id="new-service"><i class="fas fa-plus"></i> Nouveau service</button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table" id="services-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Prix unitaire</th>
                    <th>Unité</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="services-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== INVENTORY PAGE ==================== -->
      <div class="page" id="inventory-page" style="display: none;">
        <div class="card animated fade-in">
          <div class="card-header">
            <h2><i class="fas fa-boxes"></i> Gestion des stocks</h2>
            <button class="btn btn-primary" id="add-product"><i class="fas fa-plus"></i> Ajouter produit</button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table" id="inventory-table">
                <thead>
                  <tr>
                    <th>Produit</th>
                    <th>Catégorie</th>
                    <th>Qté Initiale</th>
                    <th>Qté Vendue</th>
                    <th>Qté Finale</th>
                    <th>Prix</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="inventory-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== SALES PAGE ==================== -->
      <div class="page" id="sales-page" style="display: none;">
        <div class="card animated fade-in">
          <div class="card-header">
            <h2><i class="fas fa-shopping-cart"></i> Gestion des ventes</h2>
            <button class="btn btn-primary" id="new-sale"><i class="fas fa-plus"></i> Nouvelle vente</button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table" id="sales-table">
                <thead>
                  <tr>
                    <th>N°</th>
                    <th>Date</th>
                    <th>Client</th>
                    <th>Total</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="sales-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ==================== CLIENTS PAGE ==================== -->
      <div class="page" id="clients-page" style="display: none;">
        <div class="card animated fade-in">
          <div class="card-header">
            <h2><i class="fas fa-users"></i> Gestion des clients</h2>
            <button class="btn btn-primary" id="add-client"><i class="fas fa-plus"></i> Nouveau client</button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table" id="clients-table">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Téléphone</th>
                    <th>Type</th>
                    <th>Dette</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="clients-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== REPORTS PAGE (Admin only) ==================== -->
      <div class="page" id="reports-page" style="display: none;">
        <div class="card animated fade-in">
          <div class="card-header">
            <h2><i class="fas fa-chart-line"></i> Rapports de recettes</h2>
            <div class="form-group" style="display: flex; gap: 10px; align-items: center;">
              <label for="report-date">Rechercher par date :</label>
              <input type="date" id="report-date" class="form-control" style="width: auto;">
              <button class="btn btn-primary" id="generate-report"><i class="fas fa-search"></i> Générer</button>
              <button class="btn btn-success" id="print-report"><i class="fas fa-print"></i> Imprimer</button>
            </div>
          </div>
          <div class="card-body">
            <h3 id="report-title">Recettes du jour</h3>
            <div id="daily-revenue-details">
              <!-- Revenue details will be loaded here -->
            </div>
            <hr>
            <h4>Total des bénéfices (estimé)</h4>
            <div class="value" id="total-profit-display">0 FCFA</div>
          </div>
        </div>
      </div>

      <!-- ==================== SETTINGS PAGE (Admin only) ==================== -->
      <div class="page" id="settings-page" style="display: none;">
        <div class="card animated fade-in">
          <div class="card-header">
            <h2><i class="fas fa-cog"></i> Paramètres</h2>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label>Nom de l'entreprise</label>
              <input type="text" class="form-control" id="company-name" value="GeniCopy Pro">
            </div>
            <div class="form-group">
              <label>Adresse</label>
              <textarea class="form-control" id="company-address" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label>Téléphone</label>
              <input type="text" class="form-control" id="company-phone">
            </div>
            <div class="form-group">
              <label>Devise</label>
              <input type="text" class="form-control" id="company-currency" value="FCFA">
            </div>
            <button class="btn btn-primary" id="save-settings">Enregistrer les paramètres</button>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- ====================== MODALS ===================== -->
  
  <!-- Sale Modal -->
  <div class="modal" id="sale-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4><i class="fas fa-shopping-cart"></i> Nouvelle vente</h4>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="sale-form">
          <input type="hidden" id="sale-id">
          <div class="form-group">
            <label>Client</label>
            <select class="form-control" id="sale-client">
              <option value="">Vente standard</option>
            </select>
          </div>
          <hr>
          <h5>Articles</h5>
          <div id="sale-items-container"></div>
          <button type="button" class="btn btn-secondary btn-sm" id="add-sale-item">
            <i class="fas fa-plus"></i> Ajouter un article
          </button>
          <hr>
          <div class="sale-summary">
            <strong>Total: <span id="sale-total">0 FCFA</span></strong>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary close-modal">Annuler</button>
        <button type="submit" form="sale-form" class="btn btn-primary">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Product Modal -->
  <div class="modal" id="product-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="product-modal-title">Ajouter un produit</h4>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="product-form">
          <input type="hidden" id="product-id">
          <div class="form-group">
            <label>Nom du produit</label>
            <input type="text" class="form-control" id="product-name" required>
          </div>
          <div class="form-group">
            <label>Catégorie</label>
            <input type="text" class="form-control" id="product-category" required>
          </div>
          <div class="form-group">
            <label>Quantité initiale</label>
            <input type="number" class="form-control" id="product-quantity" required min="0">
          </div>
          <div class="form-group">
            <label>Prix de vente (FCFA)</label>
            <input type="number" class="form-control" id="product-price" required min="0">
          </div>
          <div class="form-group">
            <label>Coût d'achat (FCFA)</label>
            <input type="number" class="form-control" id="product-cost" required min="0">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary close-modal">Annuler</button>
        <button type="submit" form="product-form" class="btn btn-primary">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Service Modal -->
  <div class="modal" id="service-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="service-modal-title">Ajouter un service</h4>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="service-form">
          <input type="hidden" id="service-id">
          <div class="form-group">
            <label>Nom du service</label>
            <input type="text" class="form-control" id="service-name" required>
          </div>
          <div class="form-group">
            <label>Prix unitaire (FCFA)</label>
            <input type="number" class="form-control" id="service-price" required min="0">
          </div>
          <div class="form-group">
            <label>Unité</label>
            <select class="form-control" id="service-unit" required>
              <option value="page">Page</option>
              <option value="document">Document</option>
              <option value="heure">Heure</option>
            </select>
          </div>
          <div class="form-group">
            <label>Statut</label>
            <select class="form-control" id="service-status" required>
              <option value="active">Actif</option>
              <option value="inactive">Inactif</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary close-modal">Annuler</button>
        <button type="submit" form="service-form" class="btn btn-primary">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Client Modal -->
  <div class="modal" id="client-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="client-modal-title">Ajouter un client</h4>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="client-form">
          <input type="hidden" id="client-id">
          <div class="form-group">
            <label>Nom complet</label>
            <input type="text" class="form-control" id="client-name" required>
          </div>
          <div class="form-group">
            <label>Téléphone</label>
            <input type="text" class="form-control" id="client-phone">
          </div>
          <div class="form-group">
            <label>Type de client</label>
            <select class="form-control" id="client-type" required>
              <option value="particulier">Particulier</option>
              <option value="entreprise">Entreprise</option>
              <option value="etudiant">Étudiant</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary close-modal">Annuler</button>
        <button type="submit" form="client-form" class="btn btn-primary">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- ===================== SCRIPTS ===================== -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
    $(document).ready(function() {
      // ==================== DATABASE =====================
      class Database {
        constructor() {
          this.data = {};
          this.load();
        }

        load() {
          const savedData = localStorage.getItem('genicopy_pro_data_v2');
          if (savedData) {
            this.data = JSON.parse(savedData);
          } else {
            // Initialize with default data if nothing is saved
            this.data = {
              users: [
                { id: 1, username: 'admin', password: 'admin', role: 'admin', name: 'Administrateur' },
                { id: 2, username: 'secretaire', password: 'secret', role: 'secretary', name: 'Secrétaire' }
              ],
              products: [
                { id: 1, name: 'Papier A4', category: 'Papeterie', initialQuantity: 100, soldQuantity: 0, price: 3000, cost: 2000, status: 'active' },
                { id: 2, name: 'Stylo Bic', category: 'Fourniture', initialQuantity: 200, soldQuantity: 0, price: 150, cost: 75, status: 'active' },
                { id: 3, name: 'Rame de papier', category: 'Papeterie', initialQuantity: 50, soldQuantity: 0, price: 5000, cost: 3500, status: 'active' }
              ],
              services: [
                { id: 1, name: 'Photocopie N&B', price: 50, unit: 'page', status: 'active' },
                { id: 2, name: 'Photocopie Couleur', price: 150, unit: 'page', status: 'active' },
                { id: 3, name: 'Impression document', price: 100, unit: 'page', status: 'active' }
              ],
              clients: [
                { id: 1, name: 'Client Comptant', phone: 'N/A', type: 'particulier', debt: 0 }
              ],
              sales: [],
              settings: {
                companyName: 'GeniCopy Pro',
                companyAddress: '',
                companyPhone: '',
                currency: 'FCFA'
              }
            };
            this.save();
          }
        }

        save() {
          localStorage.setItem('genicopy_pro_data_v2', JSON.stringify(this.data));
        }

        // Generic GETTER
        get(table) {
          return this.data[table] || [];
        }

        // Generic ADD
        add(table, item) {
          const newId = this.data[table].length > 0 ? Math.max(...this.data[table].map(i => i.id)) + 1 : 1;
          item.id = newId;
          this.data[table].push(item);
          this.save();
          return item;
        }

        // Generic UPDATE
        update(table, id, updatedData) {
          const itemIndex = this.data[table].findIndex(i => i.id === id);
          if (itemIndex !== -1) {
            this.data[table][itemIndex] = {...this.data[table][itemIndex], ...updatedData };
            this.save();
            return true;
          }
          return false;
        }

        // Generic DELETE
        delete(table, id) {
          this.data[table] = this.data[table].filter(i => i.id !== id);
          this.save();
          return true;
        }

        // Specific methods
        getUser(username, password) {
          return this.data.users.find(u => u.username === username && u.password === password);
        }

        getSalesByDate(date) {
          const searchDate = new Date(date).toISOString().split('T')[0];
          return this.data.sales.filter(sale => new Date(sale.date).toISOString().split('T')[0] === searchDate);
        }

        getProductSales(productId) {
          let soldQuantity = 0;
          this.data.sales.forEach(sale => {
            sale.items.forEach(item => {
              if (item.type === 'product' && item.id === productId) {
                soldQuantity += item.quantity;
              }
            });
          });
          return soldQuantity;
        }

        getServiceSales(serviceId) {
          let soldQuantity = 0;
          this.data.sales.forEach(sale => {
            sale.items.forEach(item => {
              if (item.type === 'service' && item.id === serviceId) {
                soldQuantity += item.quantity;
              }
            });
          });
          return soldQuantity;
        }

        updateProductQuantity(productId, soldQuantity) {
          const product = this.data.products.find(p => p.id === productId);
          if (product) {
            product.soldQuantity += soldQuantity;
            this.save();
          }
        }

        getDailyRevenueStats(days = 7) {
          const stats = [];
          const today = new Date();
          
          for (let i = days - 1; i >= 0; i--) {
            const date = new Date();
            date.setDate(today.getDate() - i);
            const dateStr = date.toISOString().split('T')[0];
            
            const dailySales = this.getSalesByDate(dateStr);
            const revenue = dailySales.reduce((sum, sale) => sum + sale.total, 0);
            
            stats.push({
              date: dateStr,
              revenue: revenue
            });
          }
          
          return stats;
        }
      }

      const db = new Database();
      let currentUser = null;
      let revenueChart = null;

      // ==================== APPLICATION ==================
      class GeniCopyApp {
        constructor() {
          this.init();
        }

        init() {
          this.initLogin();
          this.initAppUI();
          this.initModals();
          this.initEventListeners();
        }

        initLogin() {
          $('#login-form').on('submit', (e) => {
            e.preventDefault();
            const username = $('#username').val();
            const password = $('#password').val();
            const user = db.getUser(username, password);

            if (user) {
              currentUser = user;
              $('#login-page').hide();
              $('.app-container').show();
              this.setupUIForRole(user.role);
              this.updateUserDisplay();
              this.loadSettings();
            } else {
              $('#login-alert').show().delay(3000).fadeOut();
            }
          });

          $('#logout-btn').on('click', () => {
            currentUser = null;
            $('.app-container').hide();
            $('#login-page').show();
            $('#username').val('');
            $('#password').val('');
          });

          // Toggle password visibility
          $('#toggle-password').on('click', function() {
            const input = $('#password');
            input.attr('type', input.attr('type') === 'password' ? 'text' : 'password');
            $(this).toggleClass('fa-eye fa-eye-slash');
          });
        }

        initAppUI() {
          // Update date and time
          setInterval(() => {
            $('#current-date-time').text(new Date().toLocaleString('fr-FR'));
          }, 1000);
        }

        initModals() {
          $('.close-modal').on('click', function() {
            $(this).closest('.modal').removeClass('show');
          });

          // Initialize all modals
          this.initProductModal();
          this.initServiceModal();
          this.initClientModal();
          this.initSaleModal();
        }

        initEventListeners() {
          // Navigation toggle for mobile
          $('.user-info').on('click', () => {
            $('.user-dropdown').toggleClass('show');
          });

          // Close dropdown when clicking outside
          $(document).on('click', (e) => {
            if (!$(e.target).closest('.user-menu').length) {
              $('.user-dropdown').removeClass('show');
            }
          });

          // Print report button
          $('#print-report').on('click', () => {
            window.print();
          });

          // Save settings
          $('#save-settings').on('click', () => {
            this.saveSettings();
          });
        }

        initProductModal() {
          $('#add-product').on('click', () => {
            $('#product-modal-title').text('Ajouter un produit');
            $('#product-form')[0].reset();
            $('#product-id').val('');
            $('#product-modal').addClass('show');
          });

          $('#product-form').on('submit', (e) => {
            e.preventDefault();
            const productData = {
              name: $('#product-name').val(),
              category: $('#product-category').val(),
              initialQuantity: parseInt($('#product-quantity').val()),
              soldQuantity: 0,
              price: parseInt($('#product-price').val()),
              cost: parseInt($('#product-cost').val()),
              status: 'active'
            };

            const productId = $('#product-id').val();
            if (productId) {
              db.update('products', parseInt(productId), productData);
            } else {
              db.add('products', productData);
            }

            $('#product-modal').removeClass('show');
            this.loadInventory();
          });
        }

        initServiceModal() {
          $('#new-service').on('click', () => {
            $('#service-modal-title').text('Ajouter un service');
            $('#service-form')[0].reset();
            $('#service-id').val('');
            $('#service-modal').addClass('show');
          });

          $('#service-form').on('submit', (e) => {
            e.preventDefault();
            const serviceData = {
              name: $('#service-name').val(),
              price: parseInt($('#service-price').val()),
              unit: $('#service-unit').val(),
              status: $('#service-status').val()
            };

            const serviceId = $('#service-id').val();
            if (serviceId) {
              db.update('services', parseInt(serviceId), serviceData);
            } else {
              db.add('services', serviceData);
            }

            $('#service-modal').removeClass('show');
            this.loadServices();
          });
        }

        initClientModal() {
          $('#add-client').on('click', () => {
            $('#client-modal-title').text('Ajouter un client');
            $('#client-form')[0].reset();
            $('#client-id').val('');
            $('#client-modal').addClass('show');
          });

          $('#client-form').on('submit', (e) => {
            e.preventDefault();
            const clientData = {
              name: $('#client-name').val(),
              phone: $('#client-phone').val(),
              type: $('#client-type').val(),
              debt: 0
            };

            const clientId = $('#client-id').val();
            if (clientId) {
              db.update('clients', parseInt(clientId), clientData);
            } else {
              db.add('clients', clientData);
            }

            $('#client-modal').removeClass('show');
            this.loadClients();
          });
        }

        initSaleModal() {
          $('#new-sale').on('click', () => {
            this.openSaleModal();
          });

          $('#add-sale-item').on('click', () => {
            this.addSaleItem();
          });

          $('#sale-form').on('submit', (e) => {
            e.preventDefault();
            this.saveSale();
          });
        }

        setupUIForRole(role) {
          const nav = $('#main-nav');
          nav.empty();
          let defaultPage = '';

          const navItems = {
            dashboard: '<a href="#" class="nav-item" data-page="dashboard"><i class="fas fa-tachometer-alt"></i><span>Tableau de bord</span></a>',
            photocopy: '<a href="#" class="nav-item" data-page="photocopy"><i class="fas fa-copy"></i><span>Photocopie</span></a>',
            inventory: '<a href="#" class="nav-item" data-page="inventory"><i class="fas fa-boxes"></i><span>Inventaire</span></a>',
            sales: '<a href="#" class="nav-item" data-page="sales"><i class="fas fa-shopping-cart"></i><span>Ventes</span></a>',
            clients: '<a href="#" class="nav-item" data-page="clients"><i class="fas fa-users"></i><span>Clients</span></a>',
            reports: '<a href="#" class="nav-item" data-page="reports"><i class="fas fa-chart-line"></i><span>Rapports</span></a>',
            settings: '<a href="#" class="nav-item" data-page="settings"><i class="fas fa-cog"></i><span>Paramètres</span></a>',
          };

          if (role === 'admin') {
            nav.append(navItems.dashboard, navItems.inventory, navItems.sales, navItems.clients, navItems.reports, navItems.settings);
            defaultPage = 'dashboard';
          } else if (role === 'secretary') {
            nav.append(navItems.photocopy, navItems.sales, navItems.clients);
            defaultPage = 'sales';
          }

          // Navigation click handler
          $('.nav-item').on('click', (e) => {
            e.preventDefault();
            const page = $(e.currentTarget).data('page');
            this.navigateTo(page);
          });

          this.navigateTo(defaultPage);
        }

        navigateTo(page) {
          $('.page').hide();
          $(`#${page}-page`).show();
          $('.nav-item').removeClass('active');
          $(`.nav-item[data-page="${page}"]`).addClass('active');

          // Load data for the page
          switch (page) {
            case 'dashboard':
              this.loadDashboard();
              break;
            case 'inventory':
              this.loadInventory();
              break;
            case 'sales':
              this.loadSales();
              break;
            case 'reports':
              this.loadReports();
              break;
            case 'photocopy':
              this.loadServices();
              break;
            case 'clients':
              this.loadClients();
              break;
            case 'settings':
              this.loadSettings();
              break;
          }
        }

        updateUserDisplay() {
          $('.user-name').text(currentUser.name);
          $('.user-role').text(currentUser.role === 'admin' ? 'Administrateur' : 'Secrétaire');
          $('.user-avatar').text(currentUser.name.charAt(0));
        }

        // ==================== PAGE LOADERS ====================
        loadDashboard() {
          const sales = db.get('sales');
          const today = new Date().toISOString().split('T')[0];

          const todaySales = sales.filter(s => s.date.startsWith(today));
          const todayRevenue = todaySales.reduce((sum, s) => sum + s.total, 0);
          const todayProfit = todaySales.reduce((sum, s) => sum + s.profit, 0);

          const totalProducts = db.get('products').length;
          const totalProfit = sales.reduce((sum, s) => sum + s.profit, 0);

          const statsContainer = $('.stats-container');
          statsContainer.html(`
            <div class="stat-card">
              <h3>Recettes du jour</h3>
              <div class="value">${todayRevenue.toLocaleString('fr-FR')} FCFA</div>
            </div>
            <div class="stat-card">
              <h3>Bénéfice du jour</h3>
              <div class="value">${todayProfit.toLocaleString('fr-FR')} FCFA</div>
            </div>
            <div class="stat-card">
              <h3>Ventes du jour</h3>
              <div class="value">${todaySales.length}</div>
            </div>
            <div class="stat-card">
              <h3>Produits en stock</h3>
              <div class="value">${totalProducts}</div>
            </div>
          `);

          // Load revenue chart
          this.loadRevenueChart();
        }

        loadRevenueChart() {
          const revenueStats = db.getDailyRevenueStats(7);
          const ctx = document.getElementById('revenue-chart').getContext('2d');
          
          if (revenueChart) {
            revenueChart.destroy();
          }
          
          revenueChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: revenueStats.map(stat => {
                const date = new Date(stat.date);
                return date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
              }),
              datasets: [{
                label: 'Recettes (FCFA)',
                data: revenueStats.map(stat => stat.revenue),
                borderColor: '#4361ee',
                backgroundColor: 'rgba(67, 97, 238, 0.1)',
                tension: 0.3,
                fill: true
              }]
            },
            options: {
              responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: 'Recettes des 7 derniers jours'
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function(value) {
                      return value.toLocaleString('fr-FR') + ' FCFA';
                    }
                  }
                }
              }
            }
          });
        }

        loadInventory() {
          const products = db.get('products');
          const tableBody = $('#inventory-body');
          tableBody.empty();

          products.forEach(p => {
            const soldQty = db.getProductSales(p.id);
            const finalQty = p.initialQuantity - soldQty;
            let status = '';
            
            if (finalQty <= 0) {
              status = '<span class="badge badge-danger">Rupture</span>';
            } else if (finalQty <= 5) {
              status = '<span class="badge badge-warning">Stock faible</span>';
            } else {
              status = '<span class="badge badge-success">En stock</span>';
            }

            tableBody.append(`
              <tr>
                <td>${p.name}</td>
                <td>${p.category}</td>
                <td>${p.initialQuantity}</td>
                <td>${soldQty}</td>
                <td>${finalQty}</td>
                <td>${p.price.toLocaleString('fr-FR')} FCFA</td>
                <td>${status}</td>
                <td class="action-buttons">
                  <button class="btn btn-sm btn-primary edit-product" data-id="${p.id}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger delete-product" data-id="${p.id}">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            `);
          });

          // Add event listeners for edit and delete buttons
          $('.edit-product').on('click', (e) => {
            const productId = $(e.currentTarget).data('id');
            this.editProduct(productId);
          });

          $('.delete-product').on('click', (e) => {
            const productId = $(e.currentTarget).data('id');
            if (confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
              db.delete('products', productId);
              this.loadInventory();
            }
          });
        }

        editProduct(productId) {
          const product = db.get('products').find(p => p.id === productId);
          if (product) {
            $('#product-modal-title').text('Modifier le produit');
            $('#product-id').val(product.id);
            $('#product-name').val(product.name);
            $('#product-category').val(product.category);
            $('#product-quantity').val(product.initialQuantity);
            $('#product-price').val(product.price);
            $('#product-cost').val(product.cost);
            $('#product-modal').addClass('show');
          }
        }

        loadSales() {
          const sales = db.get('sales');
          const tableBody = $('#sales-body');
          tableBody.empty();

          // Sort sales by date (newest first)
          sales.sort((a, b) => new Date(b.date) - new Date(a.date));

          sales.forEach(s => {
            const client = db.get('clients').find(c => c.id === s.clientId) || { name: 'Standard' };
            const status = s.paid ? '<span class="badge badge-success">Payé</span>' : '<span class="badge badge-danger">Impayé</span>';
            
            tableBody.append(`
              <tr>
                <td>${s.id}</td>
                <td>${new Date(s.date).toLocaleDateString('fr-FR')}</td>
                <td>${client.name}</td>
                <td>${s.total.toLocaleString('fr-FR')} FCFA</td>
                <td>${status}</td>
                <td class="action-buttons">
                  <button class="btn btn-sm btn-info view-sale" data-id="${s.id}">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-danger delete-sale" data-id="${s.id}">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            `);
          });

          // Add event listeners for view and delete buttons
          $('.view-sale').on('click', (e) => {
            const saleId = $(e.currentTarget).data('id');
            this.viewSale(saleId);
          });

          $('.delete-sale').on('click', (e) => {
            const saleId = $(e.currentTarget).data('id');
            if (confirm('Êtes-vous sûr de vouloir supprimer cette vente ?')) {
              db.delete('sales', saleId);
              this.loadSales();
              this.loadDashboard();
            }
          });
        }

        viewSale(saleId) {
          // Implementation for viewing sale details
          alert('Détails de la vente #' + saleId);
        }

        loadReports() {
          $('#report-date').val(new Date().toISOString().split('T')[0]);
          this.displayDailyRevenue();

          $('#report-date, #generate-report').on('change click', () => this.displayDailyRevenue());
        }

        displayDailyRevenue() {
          const date = $('#report-date').val();
          const sales = db.getSalesByDate(date);

          const container = $('#daily-revenue-details');
          container.empty();

          if (sales.length === 0) {
            container.html('<p class="text-center">Aucune vente pour cette date.</p>');
            $('#report-title').text('Recettes du ' + new Date(date).toLocaleDateString('fr-FR'));
            $('#total-profit-display').text('0 FCFA');
            return;
          }

          let totalRevenue = 0;
          let totalProfit = 0;

          let table = `
            <table class="report-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Client</th>
                  <th>Produit/Service</th>
                  <th>Qté</th>
                  <th>Prix unit.</th>
                  <th>Total</th>
                  <th>Bénéfice</th>
                </tr>
              </thead>
              <tbody>
          `;
          
          sales.forEach(sale => {
            totalRevenue += sale.total;
            totalProfit += sale.profit;
            const client = db.get('clients').find(c => c.id === sale.clientId) || { name: 'Standard' };
            
            sale.items.forEach((item, index) => {
              const itemProfit = (item.price - (item.cost || 0)) * item.quantity;
              table += `
                <tr>
                  ${index === 0 ? `<td rowspan="${sale.items.length}">${new Date(sale.date).toLocaleDateString('fr-FR')}</td>
                  <td rowspan="${sale.items.length}">${client.name}</td>` : ''}
                  <td>${item.name}</td>
                  <td>${item.quantity}</td>
                  <td>${item.price.toLocaleString('fr-FR')} FCFA</td>
                  <td>${(item.price * item.quantity).toLocaleString('fr-FR')} FCFA</td>
                  <td>${itemProfit.toLocaleString('fr-FR')} FCFA</td>
                </tr>
              `;
            });
          });
          
          table += `
              </tbody>
              <tfoot>
                <tr>
                  <th colspan="5">Total</th>
                  <th>${totalRevenue.toLocaleString('fr-FR')} FCFA</th>
                  <th>${totalProfit.toLocaleString('fr-FR')} FCFA</th>
                </tr>
              </tfoot>
            </table>
          `;

          container.html(`
            <h4>Total Recettes: ${totalRevenue.toLocaleString('fr-FR')} FCFA</h4>
            <h4>Total Bénéfices: ${totalProfit.toLocaleString('fr-FR')} FCFA</h4>
            ${table}
          `);

          $('#report-title').text('Recettes du ' + new Date(date).toLocaleDateString('fr-FR'));

          // Update total profit display
          const allSales = db.get('sales');
          const overallProfit = allSales.reduce((sum, s) => sum + s.profit, 0);
          $('#total-profit-display').text(`${overallProfit.toLocaleString('fr-FR')} FCFA`);
        }

        loadServices() {
          const services = db.get('services');
          const tableBody = $('#services-body');
          tableBody.empty();

          services.forEach(s => {
            const soldQty = db.getServiceSales(s.id);
            const status = s.status === 'active' ? 
              '<span class="badge badge-success">Actif</span>' : 
              '<span class="badge badge-danger">Inactif</span>';

            tableBody.append(`
              <tr>
                <td>${s.id}</td>
                <td>${s.name}</td>
                <td>${s.price.toLocaleString('fr-FR')} FCFA</td>
                <td>${s.unit}</td>
                <td>${status}</td>
                <td class="action-buttons">
                  <button class="btn btn-sm btn-primary edit-service" data-id="${s.id}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger delete-service" data-id="${s.id}">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            `);
          });

          // Add event listeners for edit and delete buttons
          $('.edit-service').on('click', (e) => {
            const serviceId = $(e.currentTarget).data('id');
            this.editService(serviceId);
          });

          $('.delete-service').on('click', (e) => {
            const serviceId = $(e.currentTarget).data('id');
            if (confirm('Êtes-vous sûr de vouloir supprimer ce service ?')) {
              db.delete('services', serviceId);
              this.loadServices();
            }
          });
        }

        editService(serviceId) {
          const service = db.get('services').find(s => s.id === serviceId);
          if (service) {
            $('#service-modal-title').text('Modifier le service');
            $('#service-id').val(service.id);
            $('#service-name').val(service.name);
            $('#service-price').val(service.price);
            $('#service-unit').val(service.unit);
            $('#service-status').val(service.status);
            $('#service-modal').addClass('show');
          }
        }

        loadClients() {
          const clients = db.get('clients');
          const tableBody = $('#clients-body');
          tableBody.empty();

          clients.forEach(c => {
            const type = c.type === 'particulier' ? 'Particulier' : 
                         c.type === 'entreprise' ? 'Entreprise' : 'Étudiant';
            
            tableBody.append(`
              <tr>
                <td>${c.name}</td>
                <td>${c.phone}</td>
                <td>${type}</td>
                <td>${c.debt.toLocaleString('fr-FR')} FCFA</td>
                <td class="action-buttons">
                  <button class="btn btn-sm btn-primary edit-client" data-id="${c.id}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger delete-client" data-id="${c.id}">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            `);
          });

          // Add event listeners for edit and delete buttons
          $('.edit-client').on('click', (e) => {
            const clientId = $(e.currentTarget).data('id');
            this.editClient(clientId);
          });

          $('.delete-client').on('click', (e) => {
            const clientId = $(e.currentTarget).data('id');
            if (confirm('Êtes-vous sûr de vouloir supprimer ce client ?')) {
              db.delete('clients', clientId);
              this.loadClients();
            }
          });
        }

        editClient(clientId) {
          const client = db.get('clients').find(c => c.id === clientId);
          if (client) {
            $('#client-modal-title').text('Modifier le client');
            $('#client-id').val(client.id);
            $('#client-name').val(client.name);
            $('#client-phone').val(client.phone);
            $('#client-type').val(client.type);
            $('#client-modal').addClass('show');
          }
        }

        loadSettings() {
          const settings = db.data.settings || {};
          $('#company-name').val(settings.companyName || '');
          $('#company-address').val(settings.companyAddress || '');
          $('#company-phone').val(settings.companyPhone || '');
          $('#company-currency').val(settings.currency || 'FCFA');
        }

        saveSettings() {
          const settings = {
            companyName: $('#company-name').val(),
            companyAddress: $('#company-address').val(),
            companyPhone: $('#company-phone').val(),
            currency: $('#company-currency').val()
          };
          
          // Update settings
          db.data.settings = settings;
          db.save();
          
          alert('Paramètres enregistrés avec succès!');
        }

        // ==================== SALE MANAGEMENT ====================
        openSaleModal() {
          $('#sale-form')[0].reset();
          $('#sale-id').val('');
          $('#sale-items-container').empty();
          $('#sale-total').text('0 FCFA');
          
          // Populate client dropdown
          const clients = db.get('clients');
          const clientSelect = $('#sale-client');
          clientSelect.empty();
          clientSelect.append('<option value="">Vente standard</option>');
          clients.forEach(client => {
            clientSelect.append(`<option value="${client.id}">${client.name}</option>`);
          });
          
          // Add first item
          this.addSaleItem();
          
          $('#sale-modal').addClass('show');
        }

        addSaleItem() {
          const itemIndex = $('#sale-items-container .sale-item').length;
          const itemHtml = `
            <div class="sale-item" data-index="${itemIndex}">
              <select class="form-control item-type" name="items[${itemIndex}][type]">
                <option value="product">Produit</option>
                <option value="service">Service</option>
              </select>
              <select class="form-control item-id" name="items[${itemIndex}][id]">
                <option value="">Sélectionner...</option>
              </select>
              <input type="number" class="form-control item-quantity" name="items[${itemIndex}][quantity]" value="1" min="1">
              <input type="text" class="form-control item-price" name="items[${itemIndex}][price]" readonly>
              <button type="button" class="btn btn-sm btn-danger remove-item"><i class="fas fa-times"></i></button>
            </div>
          `;
          
          $('#sale-items-container').append(itemHtml);
          
          // Set up event listeners for the new item
          const newItem = $('#sale-items-container .sale-item').last();
          this.setupSaleItemEvents(newItem);
          
          // Update total
          this.updateSaleTotal();
        }

        setupSaleItemEvents(itemElement) {
          // When item type changes
          itemElement.find('.item-type').on('change', () => {
            this.updateItemOptions(itemElement);
          });
          
          // When item selection changes
          itemElement.find('.item-id').on('change', () => {
            this.updateItemPrice(itemElement);
          });
          
          // When quantity changes
          itemElement.find('.item-quantity').on('change', () => {
            this.updateItemTotal(itemElement);
          });
          
          // Remove item button
          itemElement.find('.remove-item').on('click', () => {
            if ($('#sale-items-container .sale-item').length > 1) {
              itemElement.remove();
              this.updateSaleTotal();
            }
          });
          
          // Initialize item options
          this.updateItemOptions(itemElement);
        }

        updateItemOptions(itemElement) {
          const type = itemElement.find('.item-type').val();
          const itemSelect = itemElement.find('.item-id');
          
          itemSelect.empty();
          itemSelect.append('<option value="">Sélectionner...</option>');
          
          if (type === 'product') {
            const products = db.get('products').filter(p => p.status === 'active');
            products.forEach(product => {
              const soldQty = db.getProductSales(product.id);
              const availableQty = product.initialQuantity - soldQty;
              
              if (availableQty > 0) {
                itemSelect.append(`<option value="${product.id}" data-price="${product.price}" data-cost="${product.cost}">${product.name} (${availableQty} disponible)</option>`);
              }
            });
          } else if (type === 'service') {
            const services = db.get('services').filter(s => s.status === 'active');
            services.forEach(service => {
              itemSelect.append(`<option value="${service.id}" data-price="${service.price}">${service.name}</option>`);
            });
          }
        }

        updateItemPrice(itemElement) {
          const selectedOption = itemElement.find('.item-id option:selected');
          const price = selectedOption.data('price') || 0;
          
          itemElement.find('.item-price').val(price.toLocaleString('fr-FR') + ' FCFA');
          this.updateItemTotal(itemElement);
        }

        updateItemTotal(itemElement) {
          this.updateSaleTotal();
        }

        updateSaleTotal() {
          let total = 0;
          
          $('#sale-items-container .sale-item').each(function() {
            const selectedOption = $(this).find('.item-id option:selected');
            const price = selectedOption.data('price') || 0;
            const quantity = parseInt($(this).find('.item-quantity').val()) || 0;
            
            total += price * quantity;
          });
          
          $('#sale-total').text(total.toLocaleString('fr-FR') + ' FCFA');
        }

        saveSale() {
          const clientId = $('#sale-client').val() ? parseInt($('#sale-client').val()) : null;
          const items = [];
          let total = 0;
          let profit = 0;
          
          // Validate items
          let isValid = true;
          $('#sale-items-container .sale-item').each(function() {
            const type = $(this).find('.item-type').val();
            const itemId = $(this).find('.item-id').val();
            const quantity = parseInt($(this).find('.item-quantity').val()) || 0;
            
            if (!itemId || quantity <= 0) {
              isValid = false;
              return false;
            }
            
            let itemName = '';
            let itemPrice = 0;
            let itemCost = 0;
            
            if (type === 'product') {
              const product = db.get('products').find(p => p.id === parseInt(itemId));
              if (product) {
                itemName = product.name;
                itemPrice = product.price;
                itemCost = product.cost;
                
                // Check stock availability
                const soldQty = db.getProductSales(product.id);
                const availableQty = product.initialQuantity - soldQty;
                
                if (quantity > availableQty) {
                  alert(`Stock insuffisant pour ${product.name}. Seulement ${availableQty} disponible.`);
                  isValid = false;
                  return false;
                }
              }
            } else if (type === 'service') {
              const service = db.get('services').find(s => s.id === parseInt(itemId));
              if (service) {
                itemName = service.name;
                itemPrice = service.price;
                itemCost = 0; // Services typically have no cost
              }
            }
            
            items.push({
              type: type,
              id: parseInt(itemId),
              name: itemName,
              price: itemPrice,
              cost: itemCost,
              quantity: quantity
            });
            
            total += itemPrice * quantity;
            profit += (itemPrice - itemCost) * quantity;
          });
          
          if (!isValid) {
            alert('Veuillez vérifier les articles de la vente.');
            return;
          }
          
          // Create sale object
          const sale = {
            id: db.get('sales').length + 1,
            date: new Date().toISOString(),
            clientId: clientId,
            items: items,
            total: total,
            profit: profit,
            paid: true
          };
          
          // Add sale to database
          db.add('sales', sale);
          
          // Update product quantities
          items.forEach(item => {
            if (item.type === 'product') {
              db.updateProductQuantity(item.id, item.quantity);
            }
          });
          
          // Close modal and refresh data
          $('#sale-modal').removeClass('show');
          this.loadSales();
          this.loadDashboard();
          this.loadInventory();
          
          alert('Vente enregistrée avec succès!');
        }
      }

      // Initialize the app
      new GeniCopyApp();
    });
  </script>
</body>
</html>